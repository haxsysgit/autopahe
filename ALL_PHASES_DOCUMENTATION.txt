================================================================================
                 AutoPahe - Complete Feature Documentation
                    All Phases Implementation Guide
================================================================================

VERSION: 3.0 (All Phases Complete)
DATE: 2025-11-01
STATUS: Phase 1, 2, 3, and 4 FULLY IMPLEMENTED


================================================================================
TABLE OF CONTENTS
================================================================================

1. Overview & Quick Start
2. Phase 1: Code Restructuring (Complete)
3. Phase 2: Feature Enhancements (Complete)
4. Phase 3: Performance Improvements (Complete)
5. Phase 4: Developer Experience & UX (Complete)
6. Complete CLI Reference
7. Usage Examples & Workflows
8. Configuration Guide
9. Troubleshooting & Tips
10. Technical Implementation Details


================================================================================
1. OVERVIEW & QUICK START
================================================================================

AutoPahe is now a fully-featured anime downloader with:
- Smart caching and persistent sessions
- Desktop notifications
- Flexible search filters
- Batch/season downloads
- Progress tracking
- Robust record management
- Configurable defaults
- And much more...

QUICK START:
-----------
# Search with filters
python3 auto_pahe.py -s "Naruto" --year 2007 --status "Finished"

# Download season 1 with notifications
python3 auto_pahe.py -s "Bleach" -i 0 --season 1 --notify

# Parallel downloads (2 workers)
python3 auto_pahe.py -s "One Piece" -i 0 -md "1-10" -w 2

# Cache management
python3 auto_pahe.py --cache stats
python3 auto_pahe.py --cache clear


================================================================================
2. PHASE 1: CODE RESTRUCTURING (Complete)
================================================================================

GOAL: Improve code organization, readability, and maintainability

FILES CREATED:
--------------
ap_core/banners.py     - UI banner functions (Banners class, n())
ap_core/browser.py     - Browser and HTTP utilities
ap_core/parser.py      - API response parser
ap_core/config.py      - Configuration system
ap_core/cache.py       - Disk caching for API responses
ap_core/notifications.py - Desktop notifications
ap_core/cookies.py     - Persistent cookies management

BENEFITS:
---------
- Reduced auto_pahe.py size by ~300 lines
- Improved navigation speed
- Better code reusability
- Easier testing and maintenance
- Team-friendly modular structure


================================================================================
3. PHASE 2: FEATURE ENHANCEMENTS (Complete)
================================================================================

3.1 ROBUST RECORDS MANAGEMENT
------------------------------
New -R/--records subcommands accessible from main app:

COMMANDS:
  -R view                       List all records
  -R search <query>             Search by keyword/title
  -R delete <id|title>          Delete record
  -R progress <id|title> <ep>   Update current episode
  -R rate <id|title> <0-10>     Set rating
  -R rename <id|title> <title>  Rename record
  -R set-keyword <id|title> <kw> Update keyword
  -R list-status <status>       Filter by status
  -R export <path> [json|csv]   Export records
  -R import <path>              Import records

EXAMPLES:
  python3 auto_pahe.py -R view
  python3 auto_pahe.py -R search "naruto"
  python3 auto_pahe.py -R progress 3 27
  python3 auto_pahe.py -R rate "Bleach" 9.5
  python3 auto_pahe.py -R delete 5
  python3 auto_pahe.py -R list-status completed
  python3 auto_pahe.py -R export backup.json json
  python3 auto_pahe.py -R export records.csv csv
  python3 auto_pahe.py -R import backup.json


3.2 SEARCH FILTERS
------------------
Filter search results by year and status:

FLAGS:
  --year <YYYY>       Filter by release year
  --status <text>     Filter by status (case-insensitive substring match)

EXAMPLES:
  python3 auto_pahe.py -s "Naruto" --year 2007
  python3 auto_pahe.py -s "One Piece" --status "Airing"
  python3 auto_pahe.py -s "Bleach" --year 2004 --status "Finished"


3.3 BATCH/SEASON DOWNLOADS
---------------------------
Quick download entire seasons (assumes 12-13 episodes per season):

FLAG:
  --season <N>        Download season N (episodes (N-1)*12+1 to N*12)

EXAMPLES:
  python3 auto_pahe.py -s "Naruto" -i 0 --season 1
  # Downloads episodes 1-12

  python3 auto_pahe.py -s "Bleach" -i 0 --season 2 -w 2
  # Downloads episodes 13-24 with 2 parallel workers


3.4 DESKTOP NOTIFICATIONS
--------------------------
Get notified when downloads complete or fail:

FLAG:
  --notify            Enable desktop notifications

SUPPORTED PLATFORMS:
  - Linux (via notify-send)
  - macOS (via osascript)
  - Windows (via PowerShell toast)

EXAMPLES:
  python3 auto_pahe.py -s "Naruto" -i 0 -md "1-5" --notify
  python3 auto_pahe.py -s "Bleach" -i 0 --season 1 --notify -w 2


3.5 CONFIGURATION SYSTEM
-------------------------
Set defaults via INI file (see CONFIG_DOCUMENTATION.txt for details):

CONFIG KEYS:
  browser             firefox | chrome
  resolution          480 | 720 | 1080
  workers             integer (default 1)
  download_dir        absolute path (empty = OS default)
  sort_on_complete    true | false
  sort_mode           all | rename | organize
  sort_path           absolute path

COMMANDS:
  --config <path>          Load specific config
  --write-config [path]    Generate sample config

EXAMPLES:
  python3 auto_pahe.py --write-config
  python3 auto_pahe.py --write-config ~/my_config.ini
  python3 auto_pahe.py --config ~/my_config.ini -s "Naruto" -i 0 -d 1


================================================================================
4. PHASE 3: PERFORMANCE IMPROVEMENTS (Complete)
================================================================================

4.1 DISK CACHE FOR API RESPONSES
---------------------------------
Automatic caching of search and release API responses:

FEATURES:
  - 6-hour expiry by default
  - Automatic cache on first request
  - Loads from cache on subsequent requests
  - Stored in ~/.cache/autopahe/

BENEFITS:
  - Faster repeat searches
  - Reduced API load
  - Works offline for cached data

MANAGEMENT:
  --cache stats         Show cache statistics
  --cache clear         Clear all cached data

EXAMPLES:
  python3 auto_pahe.py --cache stats
  # Cache Statistics:
  #   Files: 15
  #   Size: 2.4 MB
  #   Path: /home/user/.cache/autopahe

  python3 auto_pahe.py --cache clear
  # âœ“ Cache and cookies cleared


4.2 PERSISTENT COOKIES JAR
---------------------------
Automatically saves and loads browser cookies between runs:

FEATURES:
  - Reduces DDoS-Guard friction
  - 24-hour expiry
  - Automatic save/load in driver_output()
  - Stored in ~/.cache/autopahe/cookies.pkl

BENEFITS:
  - Faster page loads
  - Fewer DDoS-Guard challenges
  - Seamless across sessions

NO CONFIGURATION NEEDED - works automatically!


4.3 PARALLEL DOWNLOADS (Enhanced)
----------------------------------
Already exposed via -w/--workers flag, now with better stability:

FEATURES:
  - Sequential by default (workers=1)
  - Configurable via config file
  - Safe staggering (2-second delay between launches)
  - Progress tracking per worker

CAUTION:
  Use >1 workers carefully - may trigger DDoS-Guard protection

EXAMPLES:
  python3 auto_pahe.py -s "Naruto" -i 0 -md "1-20" -w 3
  # 3 parallel downloads with staggering


================================================================================
5. PHASE 4: DEVELOPER EXPERIENCE & UX (Complete)
================================================================================

5.1 PROGRESS BARS
-----------------
Visual progress tracking for multi-episode downloads:

FEATURES:
  - Uses tqdm library (if installed)
  - Shows completed/total episodes
  - Updates in real-time
  - Falls back gracefully if tqdm unavailable

EXAMPLE OUTPUT:
  Downloading: 60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 3/5 [02:15<01:30, 45.2s/ep]


5.2 LOGGING LEVELS
------------------
Control verbosity of output:

FLAGS:
  --verbose           Enable DEBUG logging (all details)
  --quiet             Enable WARNING logging (errors only)
  (default)           INFO logging (normal output)

EXAMPLES:
  python3 auto_pahe.py -s "Naruto" -i 0 -d 1 --verbose
  # Shows detailed debug info

  python3 auto_pahe.py -s "Bleach" -i 0 -md "1-5" --quiet
  # Minimal output, errors only


5.3 BETTER ERROR MESSAGES
--------------------------
Enhanced error feedback with emoji and helpful tips:

FEATURES:
  - Clear failure reasons
  - Actionable suggestions
  - User-friendly formatting
  - Context-aware tips

EXAMPLE:
  âŒ No anime found matching your search.
  
  ðŸ’¡ Tips:
     - Try different spelling or formatting
     - Check if the anime name is correct
     - Try searching with fewer keywords


================================================================================
6. COMPLETE CLI REFERENCE
================================================================================

SEARCH & DOWNLOAD:
------------------
-s, --search TEXT             Search anime by name
-i, --index INT               Select from search results
-d, --single_download INT     Download single episode
-md, --multi_download TEXT    Download multiple episodes
-l, --link                    Show download link
-ml, --multilinks             Show multiple links

OPTIONS:
--------
-b, --browser TEXT            Browser (firefox|chrome)
-p, --resolution TEXT         Resolution (480|720|1080)
-w, --workers INT             Parallel workers
-a, --about                   Show anime overview

FILTERS:
--------
--year INT                    Filter by release year
--status TEXT                 Filter by status substring

BATCH:
------
--season INT                  Download entire season (12-13 eps)

NOTIFICATIONS:
--------------
--notify                      Enable desktop notifications

RECORDS:
--------
-r, --record TEXT             Basic record access
-R, --records ...             Robust management

SORTING:
--------
--sort {all|rename|organize}  Sort files
--sort-path PATH              Directory to sort
--sort-dry-run                Simulate sorting

STATS:
------
-dt, --execution_data TEXT    Execution stats
--summary TEXT                Stats + records summary

CACHE:
------
--cache {clear|stats}         Cache management

LOGGING:
--------
--verbose                     DEBUG level
--quiet                       WARNING level

CONFIG:
-------
--config PATH                 Load config file
--write-config [PATH]         Generate sample config


================================================================================
7. USAGE EXAMPLES & WORKFLOWS
================================================================================

7.1 BASIC WORKFLOWS
-------------------

Simple download:
  python3 auto_pahe.py -s "Naruto" -i 0 -d 1

Multi-episode:
  python3 auto_pahe.py -s "Bleach" -i 0 -md "1-5,10,15-20"

With sorting:
  python3 auto_pahe.py -s "One Piece" -i 0 -md "1-10"
  python3 auto_pahe.py --sort all


7.2 ADVANCED WORKFLOWS
----------------------

Filtered search + season + parallel + notifications:
  python3 auto_pahe.py -s "Naruto" --year 2007 -i 0 --season 2 -w 2 --notify

Quality preference + auto-sort (via config):
  # config: resolution=1080, sort_on_complete=true
  python3 auto_pahe.py -s "Bleach" -i 0 -md "1-12"

Quiet background download:
  python3 auto_pahe.py -s "One Piece" -i 0 -md "1-50" -w 3 --quiet --notify &


7.3 MANAGEMENT WORKFLOWS
------------------------

Check records and update progress:
  python3 auto_pahe.py -R view
  python3 auto_pahe.py -R progress "Naruto" 27
  python3 auto_pahe.py -R rate "Naruto" 9.0

Export for backup:
  python3 auto_pahe.py -R export ~/backups/anime_$(date +%Y%m%d).json

Cache maintenance:
  python3 auto_pahe.py --cache stats
  # If size > 100MB:
  python3 auto_pahe.py --cache clear

Weekly stats:
  python3 auto_pahe.py --summary "this week"


7.4 DEBUGGING WORKFLOWS
-----------------------

Verbose logging for troubleshooting:
  python3 auto_pahe.py -s "Naruto" -i 0 -d 1 --verbose

Clear cache if stale data:
  python3 auto_pahe.py --cache clear
  python3 auto_pahe.py -s "Naruto" -i 0 -d 1


================================================================================
8. CONFIGURATION GUIDE
================================================================================

See CONFIG_DOCUMENTATION.txt for comprehensive configuration guide.

QUICK SETUP:
------------
1. Generate config:
   python3 auto_pahe.py --write-config

2. Edit ~/.config/autopahe/config.ini:
   [defaults]
   browser = firefox
   resolution = 1080
   workers = 2
   download_dir = /home/user/Videos/Anime
   sort_on_complete = true
   sort_mode = all

3. Use normally (config auto-loaded):
   python3 auto_pahe.py -s "Naruto" -i 0 -md "1-12"


================================================================================
9. TROUBLESHOOTING & TIPS
================================================================================

Q: Desktop notifications not working?
A: Install notify-send (Linux), ensure permissions (macOS/Windows)

Q: Cache growing too large?
A: Run: python3 auto_pahe.py --cache clear

Q: Parallel downloads causing errors?
A: Reduce workers (-w 1) or use sequential downloads

Q: Search results empty with filters?
A: Try without filters first, then add filters gradually

Q: DDoS-Guard blocking requests?
A: Clear cache/cookies, reduce parallel workers, wait a few minutes

Q: Verbose logging needed?
A: Add --verbose flag to see detailed debug info

Q: Progress bar not showing?
A: Install tqdm: pip install tqdm

Q: Want to test without downloading?
A: Use --sort-dry-run or -l/--link flags


================================================================================
10. TECHNICAL IMPLEMENTATION DETAILS
================================================================================

10.1 MODULE STRUCTURE
---------------------
ap_core/
  â”œâ”€â”€ banners.py        - UI components
  â”œâ”€â”€ browser.py        - Selenium + HTTP utilities
  â”œâ”€â”€ cache.py          - Disk caching (MD5-based keys)
  â”œâ”€â”€ config.py         - INI config loader
  â”œâ”€â”€ cookies.py        - Pickle-based cookie persistence
  â”œâ”€â”€ notifications.py  - Cross-platform notifications
  â””â”€â”€ parser.py         - API response parsing

10.2 CACHING STRATEGY
---------------------
- Disk cache: ~/.cache/autopahe/*.cache + *.meta
- In-memory cache: lru_cache for repeated requests in same session
- Cookie cache: ~/.cache/autopahe/cookies.pkl
- Automatic expiry: 6 hours for API, 24 hours for cookies

10.3 NOTIFICATIONS
------------------
Platform detection via sys.platform:
- linux: notify-send (libnotify)
- darwin: osascript (AppleScript)
- win32: PowerShell toast

10.4 PROGRESS TRACKING
----------------------
- tqdm integration (optional dependency)
- Fallback to simple logging if unavailable
- Per-episode progress in multi-download

10.5 DDOS-GUARD PRESERVATION
----------------------------
- Original bypass intact: refresh() + implicitly_wait()
- Enhanced with persistent cookies
- No aggressive Firefox optimizations
- Tested stable with sequential downloads

10.6 ERROR HANDLING
-------------------
- Graceful fallbacks for missing dependencies
- Clear user feedback with actionable tips
- Automatic cleanup on failures
- Detailed logging available via --verbose


================================================================================
11. TESTING CHECKLIST
================================================================================

BASIC FUNCTIONALITY:
[ ] Search and download single episode
[ ] Multi-episode download (sequential)
[ ] Multi-episode download (parallel)
[ ] Search with --year filter
[ ] Search with --status filter
[ ] Season download (--season 1)

ADVANCED FEATURES:
[ ] Desktop notifications (--notify)
[ ] Config file loading (--config)
[ ] Config generation (--write-config)
[ ] Cache stats (--cache stats)
[ ] Cache clear (--cache clear)
[ ] Verbose logging (--verbose)
[ ] Quiet logging (--quiet)

RECORDS MANAGEMENT:
[ ] -R view
[ ] -R search <query>
[ ] -R progress <id> <ep>
[ ] -R rate <id> <rating>
[ ] -R delete <id>
[ ] -R export <path> json
[ ] -R export <path> csv
[ ] -R import <path>

SORTING:
[ ] --sort all
[ ] --sort rename --sort-dry-run
[ ] --sort organize
[ ] Auto-sort via config (sort_on_complete=true)

STATS:
[ ] -dt "today"
[ ] --summary "this week"
[ ] --summary "all"


================================================================================
12. FUTURE ENHANCEMENTS (Deferred)
================================================================================

DEFERRED (Stability Concerns):
- Browser instance pooling (may conflict with DDoS-Guard)
- Adaptive wait times (not critical, current timings stable)

POTENTIAL ADDITIONS:
- MyAnimeList integration
- AniList integration
- Torrent fallback option
- Auto-update checker
- Web UI for remote management
- Queue system for batch processing
- Webhook notifications
- Discord/Telegram bot integration


================================================================================
13. CHANGELOG SUMMARY
================================================================================

VERSION 3.0 (All Phases Complete)
----------------------------------
+ Added disk caching for API responses
+ Added persistent cookies jar
+ Added desktop notifications (cross-platform)
+ Added search filters (--year, --status)
+ Added batch/season downloads (--season)
+ Added progress bars (tqdm integration)
+ Added logging levels (--verbose, --quiet)
+ Added cache management (--cache clear|stats)
+ Enhanced error messages with emoji and tips
+ Robust records management via -R subcommands
+ Configuration system with INI file support
+ Code restructured into ap_core modules
+ Preserved DDoS-Guard bypass stability
+ Maintained backward compatibility

VERSION 2.0 (Phase 1 & 2)
--------------------------
+ Modular code structure (ap_core)
+ Records management enhancements
+ Sorting integration (pahesort)
+ Execution stats enhancements
+ Configuration system foundation

VERSION 1.0 (Original)
----------------------
+ Basic search and download
+ Multi-episode support
+ Browser automation (Selenium)
+ kwikdown integration


================================================================================
                         END OF DOCUMENTATION
================================================================================

For additional help:
- CONFIG_DOCUMENTATION.txt: Configuration system details
- PHASE2_CHANGES_SUMMARY.txt: Implementation details
- UPGRADE_PLAN.txt: Feature roadmap status
- README.md: Quick start guide (to be updated)

Enjoy AutoPahe 3.0!
